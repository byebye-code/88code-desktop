name: Cross-Platform Bun Build (ä¸‰ç³»ç»Ÿæ„å»º)

# 1. è§¦å‘æ¡ä»¶ï¼šå½“ä»£ç æ¨é€åˆ° main åˆ†æ”¯ï¼Œæˆ–å‘èµ·é’ˆå¯¹ main åˆ†æ”¯çš„ Pull Request æ—¶è¿è¡Œ
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# 2. å®šä¹‰ä»»åŠ¡ (Job)
jobs:
  build:
    # ä½¿ç”¨çŸ©é˜µç­–ç•¥ï¼Œå¯¹åˆ—è¡¨ä¸­çš„æ‰€æœ‰ OS è¿›è¡Œæ„å»º
    runs-on: ${{ matrix.os }}

    strategy:
      # å®šä¹‰æ„å»ºçŸ©é˜µï¼Œç¡®ä¿åœ¨ä¸‰ä¸ªç³»ç»Ÿä¸Šæ‰§è¡Œ
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        bun-version: [latest]

    steps:
      - name: ğŸ“ æ£€å‡ºä»£ç  (Checkout code)
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ è®¾ç½® Bun (${{ matrix.bun-version }})
        # ä½¿ç”¨å®˜æ–¹ Action æ¥å®‰è£… Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: ${{ matrix.bun-version }}

      - name: ğŸ“¦ å®‰è£…ä¾èµ– (bun install)
        # --frozen-lockfile ç¡®ä¿æ‰€æœ‰ç³»ç»Ÿä½¿ç”¨ç›¸åŒçš„é”å®šæ–‡ä»¶
        run: bun install --frozen-lockfile

      - name: ğŸ”¨ æ‰§è¡Œæ„å»º (bun run build)
        # è¿™æ˜¯æ„å»ºäº§ç‰©ï¼ˆå¦‚ dist æ–‡ä»¶å¤¹ï¼‰çš„å…³é”®æ­¥éª¤
        run: bun run build

      - name: ğŸ’¾ å­˜æ¡£æ„å»ºç»“æœ (${{ matrix.os }})
        uses: actions/upload-artifact@v4
        with:
          # äº§ç‰©åç§°ä¼šæ ¹æ®æ“ä½œç³»ç»ŸåŠ¨æ€å˜åŒ–ï¼š
          # build-artifacts-ubuntu-latest, build-artifacts-macos-latest, build-artifacts-windows-latest
          name: build-artifacts-${{ matrix.os }}

          # **é‡ç‚¹ï¼šç¡®ä¿ä½ çš„ bun run build è„šæœ¬å°†æ–‡ä»¶è¾“å‡ºåˆ°è¿™ä¸ªç›®å½•**
          path: dist

          # å¦‚æœæ‰¾ä¸åˆ° dist ç›®å½•ï¼Œåˆ™å¼ºåˆ¶å·¥ä½œæµå¤±è´¥ï¼Œä»¥ä¾¿ä½ å‘ç°æ„å»ºé—®é¢˜
          if-no-files-found: error